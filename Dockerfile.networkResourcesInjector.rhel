FROM quay.io/sdaniele/builder-4-19:1-23.2 AS builder
ARG TARGETOS
ARG TARGETARCH
WORKDIR /workspace
COPY . .
RUN GOMAXPROCS=2 CGO_ENABLED=0 GOOS=${TARGETOS:-linux} GOARCH=${TARGETARCH} make build-network-resources-injector

FROM quay.io/sdaniele/base-4-19:1-23.2
ARG TARGETARCH
WORKDIR /

COPY --from=builder /workspace/bin/nri.${TARGETARCH} /webhook
